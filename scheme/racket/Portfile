# $Id: Portfile 97300 2012-09-03 03:05:48Z rmstonecipher@macports.org $

PortSystem 1.0

name            racket
epoch           1
version         5.3.1
revision        0
categories      lang scheme
platforms       darwin
license         {LGPL-2}
maintainers     rimspace.net:daniel
description     Racket is an implementation of the Scheme programming language
long_description    ${description}

homepage        http://racket-lang.org/
set subdir      installers/${version}/racket-textual/
master_sites    http://download.racket-lang.org/${subdir}
distfiles       racket-textual-${version}-src-unix.tgz
checksums       md5     fd5fc5497ecb3acb897ad95e0d2722c6 \
                sha1    d105cb454c4b2d5a7b01a77e773f8d336b87c9ff \
                rmd160  67268f8f9a6ce2176b5c379df8c7aa53c9a27577
depends_lib     port:libffi \
                port:jpeg \
                port:libpng \
                port:libiconv

worksrcdir      racket-textual-${version}/src

patch.dir   ${workpath}/racket-textual-${version}

# post-patch {
#   reinplace "s|collects|share/mzscheme|g" \
#     ${worksrcpath}/mzscheme/src/startup.ss \
#     ${worksrcpath}/mzscheme/src/startup.inc
#   reinplace "s|~/Library/PLT Scheme/|${prefix}/share/mzscheme/|g" \
#     ${worksrcpath}/mzscheme/src/file.c
# }

#   reinplace "s|@FRAMEWORK_INSTALL_DIR@|${destroot}${frameworks_dir}|" \
#     ${worksrcpath}/mzscheme/Makefile.in
#   reinplace "s|-I\$(srcdir)|-iquote \$(srcdir)|g" \
#     ${worksrcpath}/foreign/gcc/libffi/include/Makefile.in \
#     ${worksrcpath}/foreign/gcc/libffi/Makefile.in \
#     ${worksrcpath}/foreign/Makefile.in \
#     ${worksrcpath}/Makefile.in \
#     ${worksrcpath}/mzscheme/dynsrc/Makefile.in \
#     ${worksrcpath}/mzscheme/gc/doc/Makefile.in \
#     ${worksrcpath}/mzscheme/gc/include/Makefile.in \
#     ${worksrcpath}/mzscheme/gc/Makefile.in \
#     ${worksrcpath}/mzscheme/gc2/Makefile.in \
#     ${worksrcpath}/mzscheme/Makefile.in \
#     ${worksrcpath}/mzscheme/sgc/Makefile.in \
#     ${worksrcpath}/mzscheme/src/Makefile.in    
# }

# Using `--exec-prefix` convinces the Racket installer to use a "Unix style"
# installation, which really means "lay things out normal style".  Kind of a
# hack, but a better hack than not having it automatically do this...
configure.args \
    --exec-prefix=${prefix}/bin \
    --enable-macprefix \
    --enable-libffi    \
    --enable-libfw     \
    --enable-origtree

#post-destroot {
#  ln -s ${frameworks_dir}/PLT_MzScheme.framework/Versions/${version}/PLT_MzScheme \
#    ${destroot}${prefix}/lib/libmzscheme.${version}.dylib
#  
#  system "/usr/bin/install_name_tool -change PLT_MzScheme.framework/Versions/${version}_3m/PLT_MzScheme ${frameworks_dir}/PLT_MzScheme.framework/Versions/${version}_3m/PLT_MzScheme ${destroot}${prefix}/bin/mzscheme"
#}

livecheck.type  regex
livecheck.url   http://racket-lang.org/download/
livecheck.regex {Download Racket v([0-9.]+)}
